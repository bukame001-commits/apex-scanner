<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX SCANNER PRO — DIRECT ANTHROPIC</title>
    <style>
        :root { --bg:#02060a; --card:#0b1218; --accent:#00f2ff; --border:#1a2633; --text:#d1dce5; --bullish:#00ff88; }
        body { background:var(--bg); color:var(--text); font-family:sans-serif; margin:0; overflow-x:hidden; }
        .container { max-width:1000px; margin:0 auto; padding:20px; }
        .header { text-align:center; padding:20px 0; border-bottom:1px solid var(--border); }
        .header h1 { letter-spacing:4px; color:#fff; margin:0; }
        .header span { color:var(--accent); }
        .controls { background:var(--card); padding:20px; border:1px solid var(--border); margin:20px 0; }
        .btn-group { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap; }
        button { background:transparent; border:1px solid var(--border); color:var(--text); padding:10px 15px; cursor:pointer; }
        button.active { border-color:var(--accent); color:var(--accent); background:rgba(0,242,255,0.05); }
        input { width:100%; background:#000; border:1px solid var(--border); color:#fff; padding:12px; margin-bottom:10px; box-sizing:border-box; font-family:monospace; }
        .scan-btn { width:100%; border-color:var(--bullish); color:var(--bullish); font-weight:bold; font-size:14px; }
        .results { margin-top:20px; }
        .asset-row { background:var(--card); border:1px solid var(--border); padding:15px; margin-bottom:10px; display:flex; flex-direction:column; gap:10px; border-left:4px solid var(--accent); }
        .asset-top { display:flex; justify-content:space-between; align-items:center; }
        .symbol { font-weight:bold; font-size:18px; color:#fff; }
        .ai-box { font-size:13px; line-height:1.5; color:var(--text); padding-top:10px; border-top:1px solid var(--border); }
        #loader { display:none; text-align:center; padding:40px; color:var(--accent); font-family:monospace; }
    </style>
</head>
<body>
<div class="container">
    <div class="header"><h1>APEX <span>SCANNER PRO</span></h1><p>DIRECT CLAUDE AI INTEGRATION</p></div>
    
    <div class="controls">
        <div class="btn-group" id="marketSelectors">
            <button class="active" onclick="this.classList.toggle('active')">CRYPTO 1000</button>
            <button onclick="this.classList.toggle('active')">NASDAQ 100</button>
            <button onclick="this.classList.toggle('active')">S&P 500</button>
            <button onclick="this.classList.toggle('active')">RUSSELL 2000</button>
        </div>
        <div class="btn-group" id="tfSelectors">
            <button onclick="selectTF(this, '4h')">4H</button>
            <button class="active" onclick="selectTF(this, '1d')">DAILY</button>
            <button onclick="selectTF(this, '1w')">WEEKLY</button>
        </div>
        <input type="password" id="anthropicKey" placeholder="ENTER ANTHROPIC API KEY (sk-ant-...)">
        <button class="scan-btn" onclick="startScan()">⚡ EXECUTE DIRECT ANTHROPIC SCAN</button>
    </div>

    <div id="loader">ANALYZING MARKET DATA...<br><br><span id="loadDetail"></span></div>
    <div id="results" class="results"></div>
</div>

<script>
    let selectedTF = '1d';
    function selectTF(btn, tf) {
        document.querySelectorAll('#tfSelectors button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedTF = tf;
    }

    async function startScan() {
        const key = document.getElementById('anthropicKey').value.trim();
        if (!key.startsWith('sk-ant-')) return alert("Enter a valid Anthropic API key.");
        
        const loader = document.getElementById('loader');
        const resultsDiv = document.getElementById('results');
        loader.style.display = 'block';
        resultsDiv.innerHTML = '';

        try {
            // 1. DETERMINISTIC DATA FETCH (Deterministic math avoids AI hallucination)
            const winners = await fetchTechnicalData(); 
            
            // 2. DIRECT ANTHROPIC CALL (Sends real math to Claude for analysis)
            const aiSummaries = await callClaude(key, winners);
            
            render(aiSummaries);
        } catch (e) {
            alert("Error: " + e.message);
        } finally {
            loader.style.display = 'none';
        }
    }

    async function callClaude(apiKey, data) {
        const prompt = `Analyze these technical setups: ${JSON.stringify(data)}. Write a 1-sentence analysis for each. Return ONLY a JSON array: [{"symbol":"BTC","analysis":"..."}]`;
        
        const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "x-api-key": apiKey,
                "anthropic-version": "2023-06-0
