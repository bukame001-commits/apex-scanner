<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APEX SCANNER AI v2.0</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500&display=swap');
  :root {
    --bg:#040a0f;--surface:#080f17;--card:#0a1520;--border:#0e2033;
    --accent:#00d4ff;--accent2:#00ff88;--warn:#ffb800;--danger:#ff3366;
    --text:#c8dde8;--muted:#4a6070;--strong:#ffffff;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
  .container{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:20px 16px 60px;}
  .header{text-align:center;padding:30px 0 24px;}
  .header-badge{display:inline-block;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:4px;border:1px solid rgba(0,212,255,0.3);padding:4px 12px;margin-bottom:12px;animation:pulse-border 2s infinite;}
  @keyframes pulse-border{0%,100%{border-color:rgba(0,212,255,0.3);}50%{border-color:rgba(0,212,255,0.8);}}
  .header h1{font-family:'Orbitron',monospace;font-size:clamp(26px,7vw,46px);font-weight:900;color:var(--strong);letter-spacing:4px;text-shadow:0 0 40px rgba(0,212,255,0.4);}
  .header h1 span{color:var(--accent);}
  .header-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;margin-top:8px;}
  .section-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:3px;margin-bottom:10px;display:flex;align-items:center;gap:8px;}
  .section-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--border),transparent);}
  .card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:16px;margin-bottom:14px;position:relative;overflow:hidden;}
  .card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--accent);}

  /* Engine Selector */
  .engine-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .engine-btn{background:var(--surface);border:2px solid var(--border);border-radius:2px;padding:14px;cursor:pointer;transition:all 0.15s;text-align:left;}
  .engine-btn.active-claude{background:rgba(255,107,53,0.08);border-color:#ff6b35;}
  .engine-btn.active-gemini{background:rgba(0,212,255,0.08);border-color:var(--accent);}
  .engine-name{font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:var(--strong);}
  .engine-name.claude{color:#ff6b35;}
  .engine-name.gemini{color:var(--accent);}

  /* API inputs */
  .api-field{display:none;}
  .api-field.visible{display:block;}
  .api-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:10px 14px;color:var(--text);font-family:'Share Tech Mono',monospace;font-size:12px;outline:none;transition:border-color 0.15s;}
  .api-input:focus{border-color:var(--accent);}
  .api-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px;}

  /* Markets/Inds */
  .grid-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;}
  .btn-item{background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:10px 12px;cursor:pointer;transition:all 0.15s;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);text-align:left;position:relative;}
  .btn-item.active{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,0.05);}
  .btn-item.active-green{border-color:var(--accent2);color:var(--accent2);background:rgba(0,255,136,0.05);}

  /* Sliders */
  .slider-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  @media(max-width:500px){.slider-grid{grid-template-columns:1fr;}}
  .slider-item label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);display:block;margin-bottom:6px;}
  .slider-item label span{color:var(--accent);float:right;}
  input[type=range]{-webkit-appearance:none;width:100%;height:2px;background:var(--border);outline:none;}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--accent);cursor:pointer;border-radius:2px;}

  /* Buttons */
  .scan-btn{width:100%;padding:18px;background:transparent;border:1px solid var(--accent);color:var(--accent);font-family:'Orbitron',monospace;font-size:14px;font-weight:700;letter-spacing:4px;cursor:pointer;transition:0.2s;margin-top:10px;}
  .scan-btn:hover{background:rgba(0,212,255,0.1);box-shadow:0 0 20px rgba(0,212,255,0.2);}

  /* Loading */
  .loading{display:none;text-align:center;padding:40px;font-family:'Share Tech Mono',monospace;color:var(--accent);}
  .loading.visible{display:block;}
  .loading-bar{width:100%;height:2px;background:var(--border);margin:16px 0;position:relative;overflow:hidden;}
  .loading-bar::after{content:'';position:absolute;top:0;left:-40%;width:40%;height:100%;background:var(--accent);animation:scan-line 1.2s infinite;}
  @keyframes scan-line{0%{left:-40%;}100%{left:100%;}}

  /* Alert Card */
  .alert-card{background:var(--card);border:1px solid var(--border);padding:16px;margin-bottom:10px;position:relative;transition:0.15s;}
  .alert-card:hover{border-color:var(--accent);}
  .alert-card.strong::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--accent2);}
  .alert-symbol-link{font-family:'Orbitron',monospace;font-size:18px;color:var(--strong);text-decoration:none;display:flex;align-items:center;gap:8px;}
  .alert-symbol-link:hover{color:var(--accent);}
  .alert-signals{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0;}
  .signal-tag{font-family:'Share Tech Mono',monospace;font-size:9px;padding:3px 8px;border:1px solid rgba(0,212,255,0.3);color:var(--accent);background:rgba(0,212,255,0.03);}
  .alert-val{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);}
  .alert-val span{color:var(--accent);}
  
  .ai-summary{background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.2);padding:15px;margin-bottom:20px;font-size:13px;line-height:1.6;display:none;}
  .results-section{display:none;}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-badge">REAL-TIME DATA PROCESSING</div>
    <h1>APEX <span>SCANNER</span></h1>
    <div class="header-sub">TECHNICAL ANALYSIS v2.0 — HIGH PERFORMANCE</div>
  </div>

  <div id="setupPanel">
    <div class="section-label">00 — AI INSIGHT ENGINE</div>
    <div class="card">
      <div class="engine-grid">
        <button class="engine-btn" id="engineClaude" onclick="selectEngine('claude')">
          <div class="engine-name claude">CLAUDE SONNET</div>
          <div class="engine-desc">Professional deep analysis</div>
        </button>
        <button class="engine-btn active-gemini" id="engineGemini" onclick="selectEngine('gemini')">
          <div class="engine-name gemini">GEMINI FLASH</div>
          <div class="engine-desc">Fast results (OpenRouter)</div>
        </button>
      </div>
    </div>

    <div class="section-label">01 — API ACCESS</div>
    <div class="card">
      <div class="api-field" id="claudeField">
        <div class="api-label">CLAUDE API KEY</div>
        <input type="password" class="api-input" id="claudeKey" placeholder="sk-ant-...">
      </div>
      <div class="api-field visible" id="geminiField">
        <div class="api-label">OPENROUTER KEY (For Gemini)</div>
        <input type="password" class="api-input" id="geminiKey" placeholder="sk-or-v1-...">
      </div>
    </div>

    <div class="section-label">02 — TARGET MARKETS</div>
    <div class="card">
      <div class="grid-list">
        <button class="btn-item active" data-market="crypto_top50" onclick="toggleBtn(this)">CRYPTO TOP 50</button>
        <button class="btn-item" data-market="nasdaq100" onclick="toggleBtn(this)">NASDAQ 100</button>
        <button class="btn-item" data-market="sp500" onclick="toggleBtn(this)">S&P 500</button>
      </div>
    </div>

    <div class="section-label">03 — THRESHOLDS</div>
    <div class="card">
      <div class="slider-grid">
        <div class="slider-item">
          <label>RSI OVERSOLD <span id="rsiVal">30</span></label>
          <input type="range" min="10" max="50" value="30" oninput="document.getElementById('rsiVal').textContent=this.value">
        </div>
        <div class="slider-item">
          <label>MIN INDICATORS <span id="minVal">1</span></label>
          <input type="range" min="1" max="5" value="1" oninput="document.getElementById('minVal').textContent=this.value" id="minT">
        </div>
      </div>
    </div>

    <button class="scan-btn" onclick="runScan()">⚡ INITIALIZE SCAN</button>
  </div>

  <div class="loading" id="loading">
    <div id="loadingStatus">Scanning Global Liquidity...</div>
    <div class="loading-bar"></div>
  </div>

  <div class="results-section" id="resultsSection">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <div class="section-label" style="margin:0;">SCAN RESULTS</div>
      <button onclick="location.reload()" style="background:transparent; border:1px solid var(--border); color:var(--muted); padding:6px 14px; font-family:'Share Tech Mono'; font-size:10px; cursor:pointer;">↺ RESET</button>
    </div>
    
    <div class="ai-summary" id="aiSummary">
      <div style="font-family:'Orbitron'; font-size:10px; color:var(--accent); margin-bottom:10px;">⚡ AI MARKET SYNTHESIS</div>
      <div id="aiSummaryText">Processing data...</div>
    </div>

    <div id="alertsContainer"></div>
  </div>
</div>

<script>
  let selectedEngine = 'gemini';
  const TICKERS = {
    crypto_top50: ['BTC','ETH','SOL','BNB','XRP','ADA','AVAX','DOT','LINK','MATIC','NEAR','ATOM','ICP','LTC','UNI','BCH','ETC','STX','FIL','ARB'],
    nasdaq100: ['AAPL','MSFT','NVDA','AMZN','META','GOOGL','TSLA','AVGO','COST','ADBE'],
    sp500: ['JPM','V','MA','PG','JNJ','HD','XOM','CVX','LLY','MRK']
  };

  function selectEngine(e) {
    selectedEngine = e;
    document.querySelectorAll('.engine-btn').forEach(b => b.classList.remove('active-claude','active-gemini'));
    document.getElementById('engine'+e.charAt(0).toUpperCase()+e.slice(1)).classList.add('active-'+e);
    document.getElementById('claudeField').className = 'api-field' + (e==='claude'?' visible':'');
    document.getElementById('geminiField').className = 'api-field' + (e==='gemini'?' visible':'');
  }

  function toggleBtn(btn) { btn.classList.toggle('active'); }

  // --- Core Calculation Logic ---
  function calculateRSI(closes, period=14) {
    if(closes.length < period + 1) return null;
    let gains = 0, losses = 0;
    for(let i=1; i<=period; i++) {
      let diff = closes[i] - closes[i-1];
      if(diff >= 0) gains += diff; else losses -= diff;
    }
    let avgG = gains/period, avgL = losses/period;
    for(let i=period+1; i<closes.length; i++) {
      let diff = closes[i] - closes[i-1];
      avgG = (avgG * (period-1) + (diff > 0 ? diff : 0)) / period;
      avgL = (avgL * (period-1) + (diff < 0 ? -diff : 0)) / period;
    }
    return 100 - (100 / (1 + avgG/avgL));
  }

  async function fetchCryptoData(symbol) {
    try {
      const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}USDT&interval=1d&limit=50`);
      const data = await res.json();
      const closes = data.map(d => parseFloat(d[4]));
      const rsi = calculateRSI(closes);
      return { symbol, price: closes[closes.length-1], rsi, type:'crypto' };
    } catch(e) { return null; }
  }

  async function runScan() {
    const activeMarkets = Array.from(document.querySelectorAll('.btn-item.active')).map(b => b.dataset.market);
    if(!activeMarkets.length) return alert('Select a market first.');

    document.getElementById('setupPanel').style.display='none';
    document.getElementById('loading').classList.add('visible');
    
    let allData = [];
    const tickersToScan = [];
    activeMarkets.forEach(m => tickersToScan.push(...TICKERS[m]));

    for(let sym of tickersToScan) {
      document.getElementById('loadingStatus').textContent = `Crunching Data: ${sym}...`;
      const d = await fetchCryptoData(sym);
      if(d) allData.push(d);
    }

    const minRSI = parseInt(document.getElementById('rsiVal').textContent);
    const qualified = allData.filter(d => d.rsi < minRSI);

    renderResults(qualified);
    
    if(qualified.length > 0) {
      document.getElementById('aiSummary').style.display = 'block';
      generateAISummary(qualified);
    }
    
    document.getElementById('loading').classList.remove('visible');
    document.getElementById('resultsSection').style.display = 'block';
  }

  function renderResults(data) {
    const container = document.getElementById('alertsContainer');
    container.innerHTML = data.length ? '' : '<div class="card">No assets currently oversold. Try raising the RSI threshold.</div>';
    
    data.sort((a,b) => a.rsi - b.rsi).forEach(item => {
      const card = document.createElement('div');
      card.className = 'alert-card strong';
      const tvLink = `https://www.tradingview.com/chart/?symbol=BINANCE:${item.symbol}USDT`;
      
      card.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:start;">
          <a href="${tvLink}" target="_blank" class="alert-symbol-link">${item.symbol} ↗</a>
          <div style="text-align:right">
            <div style="font-family:'Orbitron'; color:var(--accent2); font-size:18px;">${item.rsi.toFixed(1)}</div>
            <div class="stat-label">RSI VALUE</div>
          </div>
        </div>
        <div class="alert-signals">
          <span class="signal-tag">DAILY RSI OVERSOLD</span>
          <span class="signal-tag">BINANCE DATA</span>
        </div>
        <div style="display:flex; gap:15px; margin-top:10px;">
          <div class="alert-val">LAST PRICE <span>$${item.price.toLocaleString()}</span></div>
        </div>
      `;
      container.appendChild(card);
    });
  }

  async function generateAISummary(qualified) {
    const key = document.getElementById(selectedEngine==='claude'?'claudeKey':'geminiKey').value;
    if(!key) {
        document.getElementById('aiSummaryText').textContent = "API Key missing. UI rendered, but AI summary skipped.";
        return;
    }

    try {
        const prompt = `Analyze these oversold assets: ${qualified.map(q=>q.symbol+'(RSI:'+q.rsi.toFixed(1)+')').join(', ')}. Write a very short, 2-sentence tactical outlook. No fluff.`;
        const model = selectedEngine === 'claude' ? 'anthropic/claude-3-sonnet' : 'google/gemini-flash-1.5';
        
        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + key,
                'Content-Type': 'application/json',
                'HTTP-Referer': 'http://localhost'
            },
            body: JSON.stringify({
                model: model,
                messages: [{role:'user', content:prompt}]
            })
        });
        const data = await res.json();
        document.getElementById('aiSummaryText').textContent = data.choices[0].message.content;
    } catch(e) {
        document.getElementById('aiSummaryText').textContent = "AI Summary failed (Check your key). UI results are still accurate.";
    }
  }
</script>
</body>
</html>
