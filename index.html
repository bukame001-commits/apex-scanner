<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APEX SCANNER AI</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500&display=swap');
  :root {
    --bg:#040a0f;--surface:#080f17;--card:#0a1520;--border:#0e2033;
    --accent:#00d4ff;--accent2:#00ff88;--warn:#ffb800;--danger:#ff3366;
    --text:#c8dde8;--muted:#4a6070;--strong:#ffffff;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
  .container{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:20px 16px 60px;}
  .header{text-align:center;padding:30px 0 24px;}
  .header-badge{display:inline-block;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:4px;border:1px solid rgba(0,212,255,0.3);padding:4px 12px;margin-bottom:12px;animation:pulse-border 2s infinite;}
  @keyframes pulse-border{0%,100%{border-color:rgba(0,212,255,0.3);}50%{border-color:rgba(0,212,255,0.8);}}
  .header h1{font-family:'Orbitron',monospace;font-size:clamp(26px,7vw,46px);font-weight:900;color:var(--strong);letter-spacing:4px;text-shadow:0 0 40px rgba(0,212,255,0.4);}
  .header h1 span{color:var(--accent);}
  .header-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;margin-top:8px;}
  .section-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:3px;margin-bottom:10px;display:flex;align-items:center;gap:8px;}
  .section-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--border),transparent);}
  .card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:16px;margin-bottom:14px;position:relative;overflow:hidden;}
  .card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--accent);}

  /* AI Engine Selector */
  .engine-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .engine-btn{background:var(--surface);border:2px solid var(--border);border-radius:2px;padding:14px;cursor:pointer;transition:all 0.15s;text-align:left;}
  .engine-btn:hover{border-color:var(--accent);}
  .engine-btn.active-claude{background:rgba(255,107,53,0.08);border-color:#ff6b35;}
  .engine-btn.active-gemini{background:rgba(0,212,255,0.08);border-color:var(--accent);}
  .engine-logo{font-size:24px;margin-bottom:6px;}
  .engine-name{font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:var(--strong);}
  .engine-name.claude{color:#ff6b35;}
  .engine-name.gemini{color:var(--accent);}
  .engine-desc{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--muted);margin-top:4px;line-height:1.5;}
  .engine-badge{display:inline-block;font-family:'Share Tech Mono',monospace;font-size:8px;padding:2px 6px;border-radius:2px;margin-top:6px;}
  .engine-badge.free{background:rgba(0,255,136,0.1);color:var(--accent2);border:1px solid rgba(0,255,136,0.3);}
  .engine-badge.paid{background:rgba(255,107,53,0.1);color:#ff6b35;border:1px solid rgba(255,107,53,0.3);}

  /* API inputs */
  .api-row{display:grid;grid-template-columns:1fr;gap:10px;}
  .api-field{display:none;}
  .api-field.visible{display:block;}
  .api-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px;letter-spacing:1px;}
  .api-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:10px 14px;color:var(--text);font-family:'Share Tech Mono',monospace;font-size:12px;outline:none;transition:border-color 0.15s;}
  .api-input:focus{border-color:var(--accent);}
  .api-input::placeholder{color:var(--muted);}
  .api-actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;}
  .api-clear-btn{font-family:'Share Tech Mono',monospace;font-size:9px;padding:5px 10px;background:transparent;border:1px solid var(--border);color:var(--muted);cursor:pointer;letter-spacing:1px;transition:all 0.15s;}
  .api-clear-btn:hover{border-color:var(--danger);color:var(--danger);}
  .api-note{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--muted);margin-top:8px;line-height:1.6;}
  .api-note a{color:var(--accent);text-decoration:none;}

  /* Markets */
  .market-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;}
  .market-btn{background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:10px 12px;cursor:pointer;transition:all 0.15s;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);text-align:left;}
  .market-btn:hover{border-color:var(--accent);color:var(--accent);}
  .market-btn.active{background:rgba(0,212,255,0.08);border-color:var(--accent);color:var(--accent);}
  .market-btn .icon{font-size:16px;display:block;margin-bottom:4px;}
  .market-btn .name{font-size:11px;font-weight:700;}
  .market-btn .desc{font-size:9px;opacity:0.6;margin-top:2px;}

  /* Indicators */
  .ind-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px;}
  .ind-btn{background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:10px 12px;cursor:pointer;transition:all 0.15s;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);text-align:left;position:relative;}
  .ind-btn:hover{border-color:var(--accent2);color:var(--text);}
  .ind-btn.active{background:rgba(0,255,136,0.06);border-color:var(--accent2);color:var(--accent2);}
  .ind-btn .ind-name{font-size:12px;font-weight:700;}
  .ind-btn .ind-desc{font-size:9px;opacity:0.6;margin-top:3px;}
  .ind-check{position:absolute;top:8px;right:8px;width:14px;height:14px;border:1px solid currentColor;border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:9px;}

  /* Sliders */
  .slider-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  @media(max-width:500px){.slider-grid{grid-template-columns:1fr;}}
  .slider-item label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);display:block;margin-bottom:6px;}
  .slider-item label span{color:var(--accent);float:right;font-size:12px;}
  input[type=range]{-webkit-appearance:none;width:100%;height:2px;background:var(--border);outline:none;}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:2px;background:var(--accent);cursor:pointer;box-shadow:0 0 8px rgba(0,212,255,0.6);}

  /* Scan button */
  .scan-btn{width:100%;padding:18px;background:transparent;border:1px solid var(--accent);color:var(--accent);font-family:'Orbitron',monospace;font-size:14px;font-weight:700;letter-spacing:4px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.2s;margin-top:6px;}
  .scan-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(0,212,255,0.1),transparent);transform:translateX(-100%);transition:transform 0.4s;}
  .scan-btn:hover::before{transform:translateX(100%);}
  .scan-btn:hover{background:rgba(0,212,255,0.08);box-shadow:0 0 30px rgba(0,212,255,0.2);}
  .scan-btn:disabled{opacity:0.4;cursor:not-allowed;}

  /* Loading */
  .loading{display:none;text-align:center;padding:40px;font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--accent);letter-spacing:2px;}
  .loading.visible{display:block;}
  .loading-bar{width:100%;height:2px;background:var(--border);margin:16px 0;position:relative;overflow:hidden;}
  .loading-bar::after{content:'';position:absolute;top:0;left:-40%;width:40%;height:100%;background:linear-gradient(90deg,transparent,var(--accent),transparent);animation:scan-line 1.2s infinite;}
  @keyframes scan-line{0%{left:-40%;}100%{left:100%;}}

  /* Results */
  .results-section{display:none;margin-top:20px;}
  .results-section.visible{display:block;}
  .results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;flex-wrap:wrap;gap:8px;}
  .results-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-bottom:16px;}
  .stat-box{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 14px;text-align:center;}
  .stat-box .stat-val{font-family:'Orbitron',monospace;font-size:22px;font-weight:700;color:var(--accent);}
  .stat-box .stat-label{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;margin-top:4px;}

  /* Alert cards */
  .alert-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:14px 16px;margin-bottom:10px;position:relative;overflow:hidden;transition:border-color 0.15s;}
  .alert-card:hover{border-color:rgba(0,212,255,0.4);}
  .alert-card.strong::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--accent2);}
  .alert-card.moderate::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--warn);}
  .alert-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;}
  .alert-symbol{font-family:'Orbitron',monospace;font-size:16px;font-weight:700;color:var(--strong);}
  .alert-market{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;}
  .alert-score{font-family:'Orbitron',monospace;font-size:20px;font-weight:900;color:var(--accent2);}
  .alert-score.moderate{color:var(--warn);}
  .alert-signals{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px;}
  .signal-tag{font-family:'Share Tech Mono',monospace;font-size:10px;padding:3px 8px;border-radius:2px;border:1px solid;}
  .signal-tag.wt{color:var(--accent);border-color:rgba(0,212,255,0.4);background:rgba(0,212,255,0.06);}
  .signal-tag.rsi{color:#ff6b35;border-color:rgba(255,107,53,0.4);background:rgba(255,107,53,0.06);}
  .signal-tag.vol{color:var(--warn);border-color:rgba(255,184,0,0.4);background:rgba(255,184,0,0.06);}
  .signal-tag.bb{color:#a78bfa;border-color:rgba(167,139,250,0.4);background:rgba(167,139,250,0.06);}
  .signal-tag.macd{color:var(--accent2);border-color:rgba(0,255,136,0.4);background:rgba(0,255,136,0.06);}
  .signal-tag.other{color:var(--muted);border-color:var(--border);}
  .alert-analysis{font-size:12px;color:var(--text);line-height:1.6;border-top:1px solid var(--border);padding-top:8px;margin-top:4px;}
  .alert-values{display:flex;gap:16px;flex-wrap:wrap;margin-top:6px;}
  .alert-val{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--muted);}
  .alert-val span{color:var(--accent);}

  /* Filter */
  .filter-bar{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;}
  .filter-btn{font-family:'Share Tech Mono',monospace;font-size:10px;padding:6px 14px;border:1px solid var(--border);background:var(--surface);color:var(--muted);cursor:pointer;border-radius:2px;transition:all 0.15s;letter-spacing:1px;}
  .filter-btn:hover,.filter-btn.active{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,0.06);}

  /* AI Summary */
  .ai-summary{background:rgba(0,212,255,0.04);border:1px solid rgba(0,212,255,0.2);border-radius:2px;padding:16px;margin-bottom:16px;font-size:13px;line-height:1.8;color:var(--text);display:none;}
  .ai-summary.visible{display:block;}
  .ai-summary-title{font-family:'Orbitron',monospace;font-size:11px;color:var(--accent);letter-spacing:2px;margin-bottom:10px;}

  .new-scan-btn{background:transparent;border:1px solid var(--border);color:var(--muted);font-family:'Share Tech Mono',monospace;font-size:10px;padding:6px 14px;cursor:pointer;letter-spacing:2px;transition:all 0.15s;}
  .new-scan-btn:hover{border-color:var(--accent);color:var(--accent);}

  .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--card);border:1px solid var(--accent2);color:var(--accent2);font-family:'Share Tech Mono',monospace;font-size:11px;letter-spacing:2px;padding:10px 20px;transition:transform 0.3s;z-index:100;}
  .toast.show{transform:translateX(-50%) translateY(0);}
  ::-webkit-scrollbar{width:4px;}
  ::-webkit-scrollbar-track{background:var(--bg);}
  ::-webkit-scrollbar-thumb{background:var(--border);}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="header-badge">AI-POWERED MARKET INTELLIGENCE</div>
    <h1>APEX <span>SCANNER</span></h1>
    <div class="header-sub">CLAUDE AI + GEMINI AI ‚Äî CHOOSE YOUR ENGINE</div>
  </div>

  <div id="errorBox" style="display:none;background:rgba(255,51,102,0.1);border:1px solid var(--danger);border-radius:2px;padding:14px;margin-bottom:14px;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--danger);line-height:1.7;word-break:break-all;"></div>

  <div id="setupPanel">

    <!-- AI Engine -->
    <div class="section-label">00 ‚Äî SELECT AI ENGINE</div>
    <div class="card">
      <div class="engine-grid">
        <button class="engine-btn" id="engineClaude" onclick="selectEngine('claude')">
          <div class="engine-logo">ü§ñ</div>
          <div class="engine-name claude">CLAUDE</div>
          <div class="engine-desc">Anthropic's Claude Sonnet<br>Superior reasoning & analysis</div>
          <div class="engine-badge paid">$5 MIN CREDIT</div>
        </button>
        <button class="engine-btn active-gemini" id="engineGemini" onclick="selectEngine('gemini')">
          <div class="engine-logo">‚ú®</div>
          <div class="engine-name gemini">GEMINI</div>
          <div class="engine-desc">Gemini Flash via OpenRouter<br>Free tier, works everywhere</div>
          <div class="engine-badge free">FREE TIER AVAILABLE</div>
        </button>
      </div>
    </div>

    <!-- API Keys -->
    <div class="section-label">01 ‚Äî API KEY</div>
    <div class="card">
      <!-- Claude Key -->
      <div class="api-field" id="claudeField">
        <div class="api-label">CLAUDE API KEY</div>
        <input type="password" class="api-input" id="claudeKey"
               placeholder="sk-or-v1-..."
               oninput="saveKey('claude', this.value)" />
        <div class="api-actions">
          <button class="api-clear-btn" onclick="clearKey('claude')">‚úï CLEAR KEY</button>
          <a href="https://console.anthropic.com" target="_blank"
             style="font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--accent);padding:5px 10px;border:1px solid rgba(0,212,255,0.3);text-decoration:none;">
            GET KEY ‚Üí
          </a>
        </div>
        <div class="api-note">One key works for ALL models. Get free key at <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai/keys</a></div>
      </div>

      <!-- Gemini Key -->
      <div class="api-field visible" id="geminiField">
        <div class="api-label">GEMINI API KEY</div>
        <input type="password" class="api-input" id="geminiKey"
               placeholder="sk-or-v1-..."
               oninput="saveKey('gemini', this.value)" />
        <div class="api-actions">
          <button class="api-clear-btn" onclick="clearKey('gemini')">‚úï CLEAR KEY</button>
          <a href="https://aistudio.google.com/app/apikey" target="_blank"
             style="font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--accent);padding:5px 10px;border:1px solid rgba(0,212,255,0.3);text-decoration:none;">
            GET FREE KEY ‚Üí
          </a>
        </div>
        <div class="api-note">Use the same OpenRouter key for both engines! Get it at <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai/keys</a></div>
      </div>

      <div class="api-field visible">
        <div class="api-label">STOCK DATA KEY (FINNHUB) ‚Äî FOR REAL STOCK DATA</div>
        <input type="password" class="api-input" id="fhKey" placeholder="your-finnhub-key"
               oninput="saveKey('fhKey', this.value)" />
        <div class="api-note">Free real stock data ‚Äî 60 calls/min. Get free key at <a href="https://finnhub.io" target="_blank">finnhub.io</a>. Leave blank to use AI estimates for stocks.</div>
      </div>
    </div>

    <!-- Markets -->
    <div class="section-label">02 ‚Äî SELECT MARKETS</div>
    <div class="card">
      <div class="market-grid">
        <button class="market-btn active" data-market="crypto_top50" onclick="toggleMarket(this)">
          <span class="icon">‚Çø</span><div class="name">CRYPTO TOP 50</div><div class="desc">By market cap</div>
        </button>
        <button class="market-btn" data-market="crypto_top100" onclick="toggleMarket(this)">
          <span class="icon">ü™ô</span><div class="name">CRYPTO TOP 100</div><div class="desc">By market cap</div>
        </button>
        <button class="market-btn" data-market="sp500" onclick="toggleMarket(this)">
          <span class="icon">üìà</span><div class="name">S&amp;P 500</div><div class="desc">US large cap</div>
        </button>
        <button class="market-btn" data-market="nasdaq100" onclick="toggleMarket(this)">
          <span class="icon">üíª</span><div class="name">NASDAQ 100</div><div class="desc">Tech index</div>
        </button>
        <button class="market-btn" data-market="russell2000" onclick="toggleMarket(this)">
          <span class="icon">üè≠</span><div class="name">RUSSELL 2000</div><div class="desc">Small cap</div>
        </button>
        <button class="market-btn" data-market="defi" onclick="toggleMarket(this)">
          <span class="icon">‚õì</span><div class="name">DEFI TOKENS</div><div class="desc">Top DeFi</div>
        </button>
      </div>
    </div>

    <!-- Indicators -->
    <div class="section-label">03 ‚Äî INDICATORS</div>
    <div class="card">
      <div class="ind-grid">
        <button class="ind-btn active" data-ind="WaveTrend" onclick="toggleInd(this)">
          <div class="ind-name">WAVETREND</div><div class="ind-desc">WT1 cross WT2 oversold</div><div class="ind-check">‚úì</div>
        </button>
        <button class="ind-btn active" data-ind="RSI Divergence" onclick="toggleInd(this)">
          <div class="ind-name">RSI + DIVERGENCE</div><div class="ind-desc">Oversold + bullish div</div><div class="ind-check">‚úì</div>
        </button>
        <button class="ind-btn" data-ind="MACD Crossover" onclick="toggleInd(this)">
          <div class="ind-name">MACD</div><div class="ind-desc">Bullish crossover</div><div class="ind-check"></div>
        </button>
        <button class="ind-btn active" data-ind="Bollinger Band Lower Touch" onclick="toggleInd(this)">
          <div class="ind-name">BOLLINGER BANDS</div><div class="ind-desc">Price at lower band</div><div class="ind-check">‚úì</div>
        </button>
        <button class="ind-btn" data-ind="Stochastic RSI" onclick="toggleInd(this)">
          <div class="ind-name">STOCH RSI</div><div class="ind-desc">K cross D in oversold</div><div class="ind-check"></div>
        </button>
        <button class="ind-btn" data-ind="200 EMA proximity" onclick="toggleInd(this)">
          <div class="ind-name">200 EMA</div><div class="ind-desc">Price near 200 EMA</div><div class="ind-check"></div>
        </button>
        <button class="ind-btn active" data-ind="Volume Spike" onclick="toggleInd(this)">
          <div class="ind-name">VOLUME SPIKE</div><div class="ind-desc">1.5x average surge</div><div class="ind-check">‚úì</div>
        </button>
        <button class="ind-btn" data-ind="VWAP" onclick="toggleInd(this)">
          <div class="ind-name">VWAP</div><div class="ind-desc">Price below VWAP</div><div class="ind-check"></div>
        </button>
        <button class="ind-btn" data-ind="ATR Expansion" onclick="toggleInd(this)">
          <div class="ind-name">ATR</div><div class="ind-desc">Volatility expansion</div><div class="ind-check"></div>
        </button>
        <button class="ind-btn" data-ind="OBV Rising" onclick="toggleInd(this)">
          <div class="ind-name">OBV</div><div class="ind-desc">Accumulation signal</div><div class="ind-check"></div>
        </button>
      </div>
    </div>

    <!-- Thresholds -->
    <div class="section-label">04 ‚Äî THRESHOLDS</div>
    <div class="card">
      <div class="slider-grid">
        <div class="slider-item">
          <label>WT OVERSOLD <span id="wtVal">-53</span></label>
          <input type="range" min="-90" max="-20" value="-53" step="1" oninput="document.getElementById('wtVal').textContent=this.value">
        </div>
        <div class="slider-item">
          <label>RSI OVERSOLD <span id="rsiVal">35</span></label>
          <input type="range" min="10" max="50" value="35" step="1" oninput="document.getElementById('rsiVal').textContent=this.value">
        </div>
        <div class="slider-item">
          <label>VOLUME MULTIPLIER <span id="volVal">1.5x</span></label>
          <input type="range" min="10" max="50" value="15" step="1" oninput="document.getElementById('volVal').textContent=(this.value/10).toFixed(1)+'x'">
        </div>
        <div class="slider-item">
          <label>MIN CONDITIONS <span id="minVal">2</span></label>
          <input type="range" min="1" max="5" value="2" step="1" oninput="document.getElementById('minVal').textContent=this.value" id="minT">
        </div>
      </div>
    </div>

    <button class="scan-btn" id="scanBtn" onclick="runScan()">‚ö° ANALYZE WITH AI</button>
  </div>

  <!-- Loading -->
  <div class="loading" id="loading">
    <div id="engineLabel">AI IS ANALYZING MARKETS...</div>
    <div class="loading-bar"></div>
    <div id="loadingStatus" style="font-size:10px;color:var(--muted);margin-top:8px;">Initializing...</div>
  </div>

  <!-- Results -->
  <div class="results-section" id="resultsSection">
    <div class="results-header">
      <div class="section-label" style="margin:0;flex:1">SCAN RESULTS</div>
      <button class="new-scan-btn" onclick="newScan()">‚Ü∫ NEW SCAN</button>
    </div>
    <div class="results-stats">
      <div class="stat-box"><div class="stat-val" id="statTotal">0</div><div class="stat-label">TOTAL</div></div>
      <div class="stat-box"><div class="stat-val" id="statStrong" style="color:var(--accent2)">0</div><div class="stat-label">STRONG</div></div>
      <div class="stat-box"><div class="stat-val" id="statMod" style="color:var(--warn)">0</div><div class="stat-label">MODERATE</div></div>
      <div class="stat-box"><div class="stat-val" id="statEngine" style="font-size:14px">‚Äî</div><div class="stat-label">AI ENGINE</div></div>
    </div>
    <div class="ai-summary" id="aiSummary">
      <div class="ai-summary-title">‚ö° AI MARKET ANALYSIS</div>
      <div id="aiSummaryText"></div>
    </div>
    <div class="filter-bar">
      <button class="filter-btn active" onclick="filterAlerts('all',this)">ALL</button>
      <button class="filter-btn" onclick="filterAlerts('strong',this)">üî• STRONG</button>
      <button class="filter-btn" onclick="filterAlerts('moderate',this)">‚ö° MODERATE</button>
      <button class="filter-btn" onclick="filterAlerts('crypto',this)">‚Çø CRYPTO</button>
      <button class="filter-btn" onclick="filterAlerts('stocks',this)">üìà STOCKS</button>
    </div>
    <div id="alertsContainer"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  let selectedEngine = 'gemini';
  let selectedMarkets = ['crypto_top50'];
  let selectedInds = ['WaveTrend','RSI Divergence','Bollinger Band Lower Touch','Volume Spike'];
  let allAlerts = [];

  const MARKET_TICKERS = {
    crypto_top50:{label:'Crypto Top 50',type:'crypto',tickers:['BTC','ETH','BNB','XRP','SOL','ADA','DOGE','TRX','DOT','MATIC','LTC','SHIB','AVAX','LINK','ATOM','UNI','XMR','ETC','XLM','BCH','ALGO','VET','FIL','ICP','HBAR','APT','ARB','NEAR','QNT','GRT','AAVE','SAND','MANA','AXS','THETA','EOS','NEO','MKR','SNX','COMP','CRV','YFI','SUSHI','ENJ','CHZ','ZIL','BAT','HOT','ONT','DASH']},
    crypto_top100:{label:'Crypto Top 100',type:'crypto',tickers:['BTC','ETH','BNB','XRP','SOL','ADA','DOGE','TRX','DOT','MATIC','LTC','SHIB','AVAX','LINK','ATOM','UNI','XMR','ETC','XLM','BCH','ALGO','VET','FIL','ICP','HBAR','APT','ARB','NEAR','QNT','GRT','AAVE','SAND','MANA','AXS','THETA','EOS','NEO','MKR','SNX','COMP','CRV','YFI','SUSHI','ENJ','CHZ','ZIL','BAT','HOT','ONT','DASH','ZEC','IOTA','XTZ','EGLD','FTM','ONE','KAVA','CELO','FLOW','ROSE','SKL','ANKR','OGN','SLP','ALICE','REEF','TLM','DENT','WIN','SC','DGB','RVN','SYS','ARDR','NXT','STEEM','LSK','PIVX','QTUM','WAN','ICX','IOST','ARK','NULS','WTC','STORM','WABI','CMT','WAVES','RUNE','LDO','FXS','CVX','GMX','DYDX','GNS','JOE','PERP']},
    sp500:{label:'S&P 500',type:'stock',tickers:['AAPL','MSFT','AMZN','NVDA','GOOGL','META','TSLA','BRK-B','UNH','LLY','JPM','V','XOM','MA','PG','JNJ','HD','AVGO','MRK','CVX','PEP','ABBV','COST','KO','WMT','ADBE','CRM','BAC','MCD','PFE','TMO','CSCO','ABT','ACN','NKE','DHR','LIN','CMCSA','TXN','VZ','PM','NEE','RTX','HON','AMGN','IBM','UNP','INTC','QCOM','INTU','SBUX','GE','LOW','AMD','CAT','DE','SPGI','MS','GS','BLK']},
    nasdaq100:{label:'Nasdaq 100',type:'stock',tickers:['AAPL','MSFT','AMZN','NVDA','GOOGL','GOOG','META','TSLA','AVGO','ADBE','CSCO','CMCSA','INTC','AMD','INTU','QCOM','HON','AMAT','SBUX','MDLZ','GILD','REGN','VRTX','ISRG','KLAC','LRCX','SNPS','CDNS','MRVL','PANW','CRWD','NFLX','PYPL','ADP','MELI','ASML','COST','PDD','KDP','ORLY','PCAR','CTAS','FTNT','FAST','CPRT','MNST','DDOG','ROST','PAYX','ODFL']},
    russell2000:{label:'Russell 2000',type:'stock',tickers:['SMCI','SAIA','GTLS','CHRD','RMBS','HALO','MGNI','CSWI','UFPI','PLXS','ITRI','ESAB','AAON','SPSC','ACLS','SFBS','CABO','ALRM','KTOS','AEIS','CPRX','MSGS','IRTC','MGPI','HTLF','PTCT','FORM','NSIT','TGTX','IDEX','AGIO','CARG','PRGS','DFIN','NEOG','HLIO','DNOW','BOOT','REPX','ARCH','AORT','INVA','DXPE','LQDT','MYRG','CNXN','PAHC','RELY','HTLD','PZZA']},
    defi:{label:'DeFi Tokens',type:'crypto',tickers:['UNI','AAVE','MKR','COMP','CRV','SNX','BAL','YFI','SUSHI','1INCH','CAKE','RUNE','LDO','FXS','CVX','GMX','DYDX','GNS','JOE','PERP']}
  };

  // ‚îÄ‚îÄ Engine selection ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function selectEngine(engine) {
    selectedEngine = engine;
    document.getElementById('engineClaude').className = 'engine-btn' + (engine==='claude' ? ' active-claude' : '');
    document.getElementById('engineGemini').className = 'engine-btn' + (engine==='gemini' ? ' active-gemini' : '');
    document.getElementById('claudeField').className = 'api-field' + (engine==='claude' ? ' visible' : '');
    document.getElementById('geminiField').className = 'api-field' + (engine==='gemini' ? ' visible' : '');
  }

  // ‚îÄ‚îÄ Key storage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function saveKey(engine, val) {
    try { localStorage.setItem('apex_key_'+engine, val); } catch(e) {}
  }

  function clearKey(engine) {
    try {
      localStorage.removeItem('apex_key_'+engine);
      document.getElementById(engine+'Key').value = '';
      showToast('KEY CLEARED');
    } catch(e) {}
  }

  function loadKeys() {
    try {
      const ck = localStorage.getItem('apex_key_claude');
      const gk = localStorage.getItem('apex_key_gemini');
      if (ck) document.getElementById('claudeKey').value = ck;
      if (gk) document.getElementById('geminiKey').value = gk;
      const fhk=localStorage.getItem('apex_key_fhKey');
      if(fhk&&document.getElementById('fhKey')) document.getElementById('fhKey').value=fhk;
    } catch(e) {}
  }

  window.addEventListener('load', loadKeys);

  // ‚îÄ‚îÄ Market / indicator toggles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleMarket(btn) {
    btn.classList.toggle('active');
    const m = btn.dataset.market;
    selectedMarkets = selectedMarkets.includes(m) ? selectedMarkets.filter(x=>x!==m) : [...selectedMarkets,m];
  }

  function toggleInd(btn) {
    btn.classList.toggle('active');
    const ind = btn.dataset.ind;
    const check = btn.querySelector('.ind-check');
    if (selectedInds.includes(ind)) { selectedInds=selectedInds.filter(x=>x!==ind); check.textContent=''; }
    else { selectedInds.push(ind); check.textContent='‚úì'; }
  }

  function showToast(msg) {
    const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),8000);
  }

  function showError(msg) {
    const box = document.getElementById('errorBox');
    box.textContent = msg;
    box.style.display = 'block';
    document.getElementById('loading').classList.remove('visible');
    document.getElementById('setupPanel').style.display = 'block';
  }

  function newScan() {
    document.getElementById('resultsSection').classList.remove('visible');
    document.getElementById('setupPanel').style.display='block';
    allAlerts=[];
  }

  // ‚îÄ‚îÄ API calls via OpenRouter (no backend needed) ‚îÄ‚îÄ‚îÄ‚îÄ
  async function callAI(prompt) {
    const keyId = selectedEngine === 'claude' ? 'claudeKey' : 'geminiKey';
    const apiKey = document.getElementById(keyId).value.trim();
    if (!apiKey) throw new Error('Enter your OpenRouter API key first ‚Äî get one free at openrouter.ai/keys');

    const model = selectedEngine === 'claude'
      ? 'anthropic/claude-haiku-4-5'
      : 'google/gemini-2.0-flash-001';

    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + apiKey,
        'HTTP-Referer': 'https://apex-scanner.app',
        'X-Title': 'APEX SCANNER'
      },
      body: JSON.stringify({
        model: model,
        max_tokens: 4096,
        messages: [{ role: 'user', content: prompt }]
      })
    });

    const rawText = await response.text();
    let data;
    try {
      data = JSON.parse(rawText);
    } catch(e) {
      throw new Error('Invalid response: ' + rawText.substring(0, 200));
    }
    if (!response.ok || data.error) throw new Error(data.error?.message || JSON.stringify(data.error) || 'API error');
    return data.choices[0].message.content;
  }

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getSignalClass(s) {
    s=s.toLowerCase();
    if(s.includes('wt')||s.includes('wave')) return 'wt';
    if(s.includes('rsi')) return 'rsi';
    if(s.includes('vol')) return 'vol';
    if(s.includes('bb')||s.includes('bolling')) return 'bb';
    if(s.includes('macd')) return 'macd';
    return 'other';
  }

  function renderAlerts(alerts) {
    const c=document.getElementById('alertsContainer');
    c.innerHTML='';
    if(alerts.length===0){
      c.innerHTML='<div style="text-align:center;padding:40px;font-family:\'Share Tech Mono\',monospace;font-size:12px;color:var(--muted);">NO ALERTS FOR CURRENT FILTER</div>';
      return;
    }
    alerts.forEach(a=>{
      const isStrong=a.score>=3;
      const card=document.createElement('div');
      card.className=`alert-card ${isStrong?'strong':'moderate'}`;
      card.dataset.type=a.type||'';
      card.dataset.strength=isStrong?'strong':'moderate';
      const signals=(a.signals||[]);
      card.innerHTML=`
        <div class="alert-top">
          <div>
            <div class="alert-symbol">${a.symbol}</div>
            <div class="alert-market">${a.market||''} ‚Ä¢ ${(a.type||'').toUpperCase()}</div>
          </div>
          <div style="text-align:right">
            <div class="alert-score ${isStrong?'':'moderate'}">${a.score}/${selectedInds.length}</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;">${isStrong?'üî• STRONG':'‚ö° MODERATE'}</div>
          </div>
        </div>
        <div class="alert-signals">${signals.map(s=>`<span class="signal-tag ${getSignalClass(s)}">${s}</span>`).join('')}</div>
        <div class="alert-analysis">${a.analysis||''}</div>
        <div class="alert-values">
          ${a.wt1!==undefined?`<div class="alert-val">WT1 <span>${a.wt1}</span></div>`:''}
          ${a.rsi!==undefined?`<div class="alert-val">RSI <span>${a.rsi}</span></div>`:''}
          ${a.timeframe?`<div class="alert-val">TF <span>${a.timeframe}</span></div>`:''}
        </div>`;
      c.appendChild(card);
    });
  }

  function filterAlerts(type,btn) {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    let f=allAlerts;
    if(type==='strong') f=allAlerts.filter(a=>a.score>=3);
    else if(type==='moderate') f=allAlerts.filter(a=>a.score===2);
    else if(type==='crypto') f=allAlerts.filter(a=>a.type==='crypto');
    else if(type==='stocks') f=allAlerts.filter(a=>a.type==='stock');
    renderAlerts(f);
  }

  // ‚îÄ‚îÄ Main scan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function runScan() {
    if(selectedMarkets.length===0){showToast('SELECT AT LEAST ONE MARKET');return;}
    if(selectedInds.length===0){showToast('SELECT AT LEAST ONE INDICATOR');return;}

    const wtT=document.getElementById('wtVal').textContent;
    const rsiT=document.getElementById('rsiVal').textContent;
    const volT=document.getElementById('volVal').textContent;
    const minT=document.getElementById('minT').value;
    const engineName=selectedEngine==='claude'?'CLAUDE':'GEMINI';

    document.getElementById('setupPanel').style.display='none';
    document.getElementById('loading').classList.add('visible');
    document.getElementById('resultsSection').classList.remove('visible');
    document.getElementById('engineLabel').textContent=`${engineName} IS ANALYZING MARKETS...`;
    allAlerts=[];

    try {
      let allTickers=[];
      selectedMarkets.forEach(m=>{
        if(MARKET_TICKERS[m]){
          MARKET_TICKERS[m].tickers.forEach(t=>{
            allTickers.push({symbol:t,market:MARKET_TICKERS[m].label,type:MARKET_TICKERS[m].type});
          });
        }
      });
      const seen=new Set();
      allTickers=allTickers.filter(t=>{if(seen.has(t.symbol))return false;seen.add(t.symbol);return true;});

      const marketsList=selectedMarkets.map(m=>MARKET_TICKERS[m]?.label).join(', ');

      // ‚îÄ‚îÄ Real data functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function calcRSI(closes, period) {
        if (!closes || closes.length < period+1) return null;
        let gains=0, losses=0;
        for (let i=closes.length-period; i<closes.length; i++) {
          const d=closes[i]-closes[i-1];
          if(d>0) gains+=d; else losses+=Math.abs(d);
        }
        const rs=gains/(losses||0.0001);
        return parseFloat((100-100/(1+rs)).toFixed(1));
      }

      function calcEMA(closes, period) {
        if (!closes || closes.length<period) return null;
        const k=2/(period+1);
        let ema=closes.slice(0,period).reduce((a,b)=>a+b,0)/period;
        for (let i=period; i<closes.length; i++) ema=closes[i]*k+ema*(1-k);
        return parseFloat(ema.toFixed(4));
      }

      function calcVolSpike(volumes) {
        if (!volumes || volumes.length<20) return null;
        const avg=volumes.slice(-20,-1).reduce((a,b)=>a+b,0)/19;
        return avg>0 ? parseFloat((volumes[volumes.length-1]/avg).toFixed(2)) : null;
      }

      async function fetchCryptoData(symbol) {
        try {
          const url='https://fapi.binance.com/fapi/v1/klines?symbol='+symbol+'USDT&interval=1w&limit=210';
          const res=await fetch(url);
          if(!res.ok) return null;
          const candles=await res.json();
          if(!candles||candles.length<20) return null;
          const closes=candles.map(c=>parseFloat(c[4]));
          const volumes=candles.map(c=>parseFloat(c[5]));
          return {closes, volumes, price:closes[closes.length-1]};
        } catch(e) { return null; }
      }

      async function fetchStockData(symbol) {
        const fhEl=document.getElementById('fhKey');
        const fhKey=fhEl?fhEl.value.trim():'';
        if(!fhKey||fhKey.length<5) {
          console.log('Finnhub key missing for',symbol);
          return null;
        }
        try {
          const now=Math.floor(Date.now()/1000);
          const from=now-(4*365*24*3600);
          const url='https://finnhub.io/api/v1/stock/candle?symbol='+encodeURIComponent(symbol)+'&resolution=W&from='+from+'&to='+now+'&token='+encodeURIComponent(fhKey);
          console.log('Fetching Finnhub for',symbol,'key length:',fhKey.length);
          const res=await fetch(url,{
            headers:{'X-Finnhub-Token':fhKey}
          });
          const text=await res.text();
          if(!res.ok){
            console.log('Finnhub error for',symbol,':',text.substring(0,100));
            return null;
          }
          const data=JSON.parse(text);
          if(!data||data.s==='no_data'||!data.c||data.c.length<20) return null;
          return {closes:data.c, volumes:data.v, price:data.c[data.c.length-1]};
        } catch(e) {
          console.log('Finnhub exception for',symbol,':',e.message);
          return null;
        }
      }

      const realData={};
      const cryptoTickers=allTickers.filter(t=>t.type==='crypto');
      const stockTickers=allTickers.filter(t=>t.type==='stock');
      const fhKey=document.getElementById('fhKey')?document.getElementById('fhKey').value.trim():'';

      // Fetch crypto in parallel batches of 10
      for(let i=0;i<cryptoTickers.length;i+=10){
        const batch=cryptoTickers.slice(i,i+10);
        document.getElementById('loadingStatus').textContent='Fetching crypto data '+(i+1)+'-'+Math.min(i+10,cryptoTickers.length)+' of '+cryptoTickers.length+'...';
        await Promise.all(batch.map(async t=>{
          const d=await fetchCryptoData(t.symbol);
          if(!d) return;
          realData[t.symbol]={price:d.price,rsi:calcRSI(d.closes,14),ema200:calcEMA(d.closes,200),volSpike:calcVolSpike(d.volumes),type:'crypto'};
        }));
        await new Promise(r=>setTimeout(r,100));
      }

      // Fetch stocks via Finnhub (60 calls/min free = batch of 10 per second)
      if(fhKey){
        for(let i=0;i<stockTickers.length;i+=10){
          const batch=stockTickers.slice(i,i+10);
          document.getElementById('loadingStatus').textContent='Fetching stock data '+(i+1)+'-'+Math.min(i+10,stockTickers.length)+' of '+stockTickers.length+'...';
          await Promise.all(batch.map(async t=>{
            const d=await fetchStockData(t.symbol);
            if(!d) return;
            realData[t.symbol]={price:d.price,rsi:calcRSI(d.closes,14),ema200:calcEMA(d.closes,200),volSpike:calcVolSpike(d.volumes),type:'stock'};
          }));
          await new Promise(r=>setTimeout(r,1000)); // 1s between batches = 10 calls/sec = 600/min (within 60/min per batch limit)
        }
      }

      // Pre-filter with real data
      const qualified=[];
      allTickers.forEach(t=>{
        const d=realData[t.symbol];
        if(!d) return;
        const sigs=[];
        if(d.rsi!==null&&d.rsi<parseFloat(rsiT)) sigs.push('RSI oversold ('+d.rsi+')');
        if(d.volSpike!==null&&d.volSpike>=parseFloat(volT)) sigs.push('Volume Spike '+d.volSpike+'x');
        if(d.ema200!==null&&Math.abs((d.price/d.ema200-1)*100)<=5) sigs.push('Near 200 EMA');
        if(sigs.length>=parseInt(minT)) qualified.push({...t,sigs,d});
      });

      const realCount=Object.keys(realData).length;
      document.getElementById('loadingStatus').textContent=realCount+' assets fetched. '+qualified.length+' qualify. Sending to AI...';
      await new Promise(r=>setTimeout(r,300));

      // Build ticker list for AI - use real qualified data if available, else all tickers
      const aiTickers=(qualified.length>0)
        ? qualified.map(q=>`${q.symbol}(RSI:${q.d.rsi},VolSpike:${q.d.volSpike}x,EMA200:${q.d.ema200?((q.d.price/q.d.ema200-1)*100).toFixed(1)+'%':'N/A'})`).join(',')
        : allTickers.map(t=>`${t.symbol}(${t.market})`).join(',');

      const tickerList=aiTickers;

      document.getElementById('loadingStatus').textContent=`Analyzing ${allTickers.length} assets across ${selectedMarkets.length} market(s)...`;

      const prompt=`You are an expert technical analyst. Today is ${new Date().toDateString()}.

Analyze these ${allTickers.length} assets on their WEEKLY charts: ${tickerList}

SCREENING CRITERIA:
- Indicators: ${selectedInds.join(', ')}
- WaveTrend oversold threshold: ${wtT}
- RSI oversold threshold: ${rsiT}
- Volume spike: ${volT} above average
- Minimum signals to qualify: ${minT} of ${selectedInds.length}

Identify assets MOST LIKELY showing oversold weekly conditions and potential reversal setups based on current market conditions as of ${new Date().toDateString()}.

IMPORTANT: Respond with ONLY a raw JSON array. No markdown. No backticks. No explanation. Start your response with [ and end with ]. Nothing else.
[{"symbol":"BTC","market":"Crypto Top 50","type":"crypto","score":3,"signals":["WaveTrend Oversold","RSI Divergence","Volume Spike"],"wt1":-58.2,"rsi":31.4,"timeframe":"1W","analysis":"1 sentence max"}]

Rules:
- Only include assets meeting at least ${minT} criteria
- Maximum 8 results only, sorted by score descending
- Be selective and realistic based on current ${new Date().toDateString()} market conditions
- Return [] if nothing qualifies
- Score = number of triggered indicators (max ${selectedInds.length})`;

      document.getElementById('loadingStatus').textContent='Analyzing chart patterns...';
      const response=await callAI(prompt);

      let parsed=[];
      console.log('Raw AI response:', response);
      try {
        let clean=response.replace(/```json|```/gi,'').trim();
        const s=clean.indexOf('['), e=clean.lastIndexOf(']');
        if(s!==-1&&e!==-1){
          clean=clean.slice(s,e+1);
          parsed=JSON.parse(clean);
        } else {
          // No array found ‚Äî show raw response to user for debugging
            showError('DEBUG - No JSON array found in response. Raw: ' + response.substring(0,400));
        }
      } catch(err){
        console.error('Parse error:',err);
        showError('DEBUG - Parse error: ' + err.message + ' | Raw response: ' + response.substring(0,400));
        parsed=[];
      }

      allAlerts=parsed;

      document.getElementById('loadingStatus').textContent='Generating market summary...';

      const summaryPrompt=`Write a concise 3-sentence market summary for a trader covering ${marketsList} as of ${new Date().toDateString()}:
1. Overall market sentiment
2. Which sector looks most oversold/interesting
3. Key risk to watch
Be direct, specific, no disclaimers.`;

      const summary=await callAI(summaryPrompt);

      document.getElementById('loading').classList.remove('visible');
      document.getElementById('resultsSection').classList.add('visible');

      const strong=allAlerts.filter(a=>a.score>=3).length;
      document.getElementById('statTotal').textContent=allAlerts.length;
      document.getElementById('statStrong').textContent=strong;
      document.getElementById('statMod').textContent=allAlerts.length-strong;
      document.getElementById('statEngine').textContent=engineName;
      document.getElementById('aiSummaryText').textContent=summary;
      document.getElementById('aiSummary').classList.add('visible');

      allAlerts.sort((a,b)=>b.score-a.score);
      renderAlerts(allAlerts);

    } catch(err) {
      showError('ERROR: ' + err.message);
      console.error(err);
    }
  }
</script>
</body>
</html>
